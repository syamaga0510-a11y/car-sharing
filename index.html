<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂÆ∂Êóè„Ç´„Éº„Ç∑„Çß„Ç¢ÁÆ°ÁêÜ</title>
    <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2d5f8d;
            --primary-light: #4a8bc2;
            --secondary: #f39c12;
            --bg: #f8f9fc;
            --card-bg: #ffffff;
            --text: #1a1a2e;
            --text-light: #6c757d;
            --border: #e1e8ed;
            --success: #27ae60;
            --shadow: 0 4px 6px rgba(0,0,0,0.07);
            --shadow-lg: 0 10px 30px rgba(0,0,0,0.12);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-lg);
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .car-icon {
            font-size: 2.5rem;
        }

        .date-display {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.1rem;
            color: var(--text-light);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            animation: fadeIn 0.6s ease 0.2s both;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .calendar-section {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .calendar-header h2 {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }

        .day-header {
            text-align: center;
            font-weight: 600;
            padding: 15px 5px;
            color: var(--primary);
            font-size: 0.9rem;
        }

        .day-header.sunday {
            color: #e74c3c;
        }

        .day-header.saturday {
            color: #3498db;
        }

        .day-cell {
            aspect-ratio: 1;
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            background: var(--bg);
        }

        .day-cell:hover {
            border-color: var(--primary);
            transform: scale(1.05);
            box-shadow: var(--shadow);
        }

        .day-cell.other-month {
            opacity: 0.3;
        }

        .day-cell.selected {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            border-color: var(--primary);
        }

        .day-cell.today {
            background: #fff3cd;
            border-color: var(--secondary);
            font-weight: 700;
        }

        .day-cell.today.selected {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            border-color: var(--primary);
        }

        .day-cell.sunday .day-number {
            color: #e74c3c;
        }

        .day-cell.saturday .day-number {
            color: #3498db;
        }

        .day-cell.sunday.selected .day-number,
        .day-cell.saturday.selected .day-number {
            color: white;
        }

        .day-number {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 5px;
        }

        .day-reservations {
            display: flex;
            flex-direction: column;
            gap: 2px;
            margin-top: 5px;
        }

        .reservation-indicator {
            width: 100%;
            height: 4px;
            border-radius: 2px;
            background: var(--secondary);
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .card {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
        }

        .card h3 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--primary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text);
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-family: 'Outfit', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(45, 95, 141, 0.1);
        }

        .btn-primary {
            width: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 12px;
            font-family: 'Outfit', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .reservation-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .reservation-item {
            padding: 15px;
            background: var(--bg);
            border-radius: 12px;
            margin-bottom: 12px;
            border-left: 4px solid var(--secondary);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .reservation-item h4 {
            font-size: 1.05rem;
            margin-bottom: 8px;
            color: var(--primary);
        }

        .reservation-detail {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 4px;
            font-family: 'JetBrains Mono', monospace;
        }

        .reservation-price {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--success);
            margin-top: 8px;
        }

        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            background: #c0392b;
            transform: scale(1.05);
        }

        .family-members {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .member-tag {
            padding: 8px 15px;
            background: var(--bg);
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--primary);
            border: 2px solid var(--border);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            padding: 20px;
            border-radius: 12px;
            color: white;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        .stat-label {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-top: 5px;
        }

        .calculation-display {
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid var(--secondary);
        }

        .calculation-display p {
            margin: 5px 0;
            font-size: 0.95rem;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .calendar {
                gap: 5px;
            }

            .day-cell {
                padding: 5px;
            }
        }

        /* „É≠„Ç∞„Ç§„É≥„É¢„Éº„ÉÄ„É´„ÅÆ„Çπ„Çø„Ç§„É´ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 400px;
            width: 90%;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-content h2 {
            color: var(--primary);
            margin-bottom: 30px;
            text-align: center;
            font-size: 1.8rem;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .pin-input {
            padding: 15px;
            font-size: 1.5rem;
            text-align: center;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            letter-spacing: 0.5em;
        }

        .pin-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .logout-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .manage-members-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            margin-left: 10px;
        }

        .manage-members-btn:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
        }

        .member-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .member-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--bg);
            border-radius: 8px;
            border: 2px solid var(--border);
        }

        .member-name {
            font-weight: 600;
            color: var(--text);
        }

        .delete-member-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .delete-member-btn:hover {
            background: #c0392b;
        }

        .admin-mode-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            margin-left: 10px;
        }

        .admin-mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .stats-table th,
        .stats-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .stats-table th {
            background: var(--bg);
            font-weight: 600;
            color: var(--primary);
        }

        .stats-table tr:hover {
            background: var(--bg);
        }

        .month-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .month-selector button {
            padding: 8px 15px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .month-selector button:hover {
            background: var(--primary-light);
        }

        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border);
        }

        .admin-tab {
            padding: 12px 20px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            color: var(--text-light);
            transition: all 0.3s ease;
        }

        .admin-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .admin-tab:hover {
            color: var(--primary);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ÂàùÊúü„É°„É≥„Éê„Éº„Éá„Éº„ÇøÔºàFirebase„Å´‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅÆÂàùÊúüÂÄ§Ôºâ
        const INITIAL_MEMBERS = [
            { name: 'ÁÆ°ÁêÜËÄÖ', pin: '0000', isAdmin: true }
        ];

        const firebaseConfig = {
            apiKey: "AIzaSyCd8tnYHwCY93tEXRhxPIjX9Dks2ly25MY",
            authDomain: "family-car-share-8a1c4.firebaseapp.com",
            databaseURL: "https://family-car-share-8a1c4-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "family-car-share-8a1c4",
            storageBucket: "family-car-share-8a1c4.firebasestorage.app",
            messagingSenderId: "61412197996",
            appId: "1:61412197996:web:d65b24df6a1bb83519ba49",
            measurementId: "G-C0CP5Z1ZND"
        };

        // FirebaseÂàùÊúüÂåñ
        let database;
        let isFirebaseReady = false;
        
        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            database = firebase.database();
            isFirebaseReady = true;
        } catch (error) {
            console.error('FirebaseÂàùÊúüÂåñ„Ç®„É©„Éº:', error);
        }

        const calculatePrice = (hours) => {
            if (hours <= 1) {
                return 500;
            } else if (hours <= 3) {
                return 1000;
            } else if (hours <= 6) {
                return 2000;
            } else if (hours <= 12) {
                return 2500;
            } else if (hours <= 24) {
                return 3000;
            } else if (hours <= 48) {
                return 6000;
            } else {
                // 48ÊôÇÈñì„ÇíË∂Ö„Åà„ÇãÂ†¥Âêà: 6000ÂÜÜ + 24ÊôÇÈñì„Åî„Å®„Å´3000ÂÜÜ
                const extraHours = hours - 48;
                const extraDays = Math.ceil(extraHours / 24);
                return 6000 + (extraDays * 3000);
            }
        };

        const CarSharingApp = () => {
            const [currentDate, setCurrentDate] = useState(new Date());
            const [selectedDate, setSelectedDate] = useState(new Date());
            const [reservations, setReservations] = useState([]);
            const [formData, setFormData] = useState(() => {
                const today = new Date();
                const year = today.getFullYear();
                const month = String(today.getMonth() + 1).padStart(2, '0');
                const day = String(today.getDate()).padStart(2, '0');
                const localDateString = `${year}-${month}-${day}`;
                
                return {
                    member: '', // „É°„É≥„Éê„Éº„ÅØÂæå„ÅßË®≠ÂÆö
                    date: localDateString,
                    startHour: '12',
                    startMinute: '00',
                    endHour: '12',
                    endMinute: '00'
                };
            });
            const [calculatedPrice, setCalculatedPrice] = useState(null);
            const [calculatedHours, setCalculatedHours] = useState(null);
            const [isLoading, setIsLoading] = useState(true);
            const [connectionStatus, setConnectionStatus] = useState('Êé•Á∂ö‰∏≠...');
            const [currentUser, setCurrentUser] = useState(null); // ÁèæÂú®„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅÑ„Çã„É¶„Éº„Ç∂„Éº
            const [isAuthenticated, setIsAuthenticated] = useState(false); // Ë™çË®ºÁä∂ÊÖã
            const [showLoginModal, setShowLoginModal] = useState(true); // „É≠„Ç∞„Ç§„É≥„É¢„Éº„ÉÄ„É´„ÅÆË°®Á§∫Áä∂ÊÖã
            const [pinInput, setPinInput] = useState(''); // PINÂÖ•ÂäõÂÄ§
            const [selectedMemberForLogin, setSelectedMemberForLogin] = useState(''); // „É≠„Ç∞„Ç§„É≥ÂØæË±°„É°„É≥„Éê„Éº
            const [members, setMembers] = useState([]); // „É°„É≥„Éê„Éº„É™„Çπ„Éà
            const [showMemberManagement, setShowMemberManagement] = useState(false); // „É°„É≥„Éê„ÉºÁÆ°ÁêÜ„É¢„Éº„ÉÄ„É´
            const [newMemberName, setNewMemberName] = useState(''); // Êñ∞Ë¶è„É°„É≥„Éê„ÉºÂêç
            const [newMemberPin, setNewMemberPin] = useState(''); // Êñ∞Ë¶è„É°„É≥„Éê„ÉºPIN
            const [isAdmin, setIsAdmin] = useState(false); // ÁÆ°ÁêÜËÄÖ„Åã„Å©„ÅÜ„Åã
            const [showAdminMode, setShowAdminMode] = useState(false); // ÁÆ°ÁêÜËÄÖ„É¢„Éº„ÉâË°®Á§∫
            const [selectedMonth, setSelectedMonth] = useState(new Date()); // Áµ±Ë®àË°®Á§∫Áî®„ÅÆÊúà
            const [selectedMemberForStats, setSelectedMemberForStats] = useState(''); // Áµ±Ë®àË°®Á§∫Áî®„ÅÆ„É°„É≥„Éê„Éº

            // localStorage„Åã„ÇâË™çË®ºÊÉÖÂ†±„ÇíÂæ©ÂÖÉ
            useEffect(() => {
                const savedUser = localStorage.getItem('authenticatedUser');
                if (savedUser) {
                    setCurrentUser(savedUser);
                    setIsAuthenticated(true);
                    setShowLoginModal(false);
                    // ÁÆ°ÁêÜËÄÖ„Éï„É©„Ç∞„ÅØ„É°„É≥„Éê„Éº„É™„Çπ„Éà„ÅåË™≠„ÅøËæº„Åæ„Çå„ÅüÂæå„Å´Ë®≠ÂÆö
                }
            }, []);

            // „É°„É≥„Éê„Éº„É™„Çπ„Éà„ÅåË™≠„ÅøËæº„Åæ„Çå„ÅüÂæå„ÄÅ‰øùÂ≠ò„Åï„Çå„Åü„É¶„Éº„Ç∂„Éº„ÅÆÁÆ°ÁêÜËÄÖ„Éï„É©„Ç∞„ÇíÂæ©ÂÖÉ
            useEffect(() => {
                if (currentUser && members.length > 0) {
                    const member = members.find(m => m.name === currentUser);
                    if (member) {
                        setIsAdmin(member.isAdmin || false);
                    }
                }
            }, [members, currentUser]);

            // Firebase„Åã„Çâ„É°„É≥„Éê„Éº„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø
            useEffect(() => {
                if (!isFirebaseReady) return;

                const membersRef = database.ref('members');
                
                const listener = membersRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        const membersList = Object.keys(data).map(key => ({
                            id: key,
                            name: data[key].name,
                            pin: data[key].pin,
                            isAdmin: data[key].isAdmin || false
                        }));
                        setMembers(membersList);
                        
                        // ÂàùÂõûÈÅ∏ÊäûÁî®„Å´„É°„É≥„Éê„Éº„ÅåÂ≠òÂú®„Åô„ÇãÂ†¥Âêà„ÅØÊúÄÂàù„ÅÆ„É°„É≥„Éê„Éº„ÇíÈÅ∏Êäû
                        if (membersList.length > 0 && !selectedMemberForLogin) {
                            setSelectedMemberForLogin(membersList[0].name);
                        }
                    } else {
                        // ÂàùÊúü„É°„É≥„Éê„Éº„ÇíFirebase„Å´ÁôªÈå≤
                        INITIAL_MEMBERS.forEach(member => {
                            membersRef.push({
                                name: member.name,
                                pin: member.pin,
                                isAdmin: member.isAdmin || false
                            });
                        });
                    }
                });

                return () => membersRef.off('value', listener);
            }, []);

            // Firebase„Åã„Çâ„ÅÆ„É™„Ç¢„É´„Çø„Ç§„É†„Éá„Éº„ÇøÁõ£Ë¶ñ
            useEffect(() => {
                if (!isFirebaseReady) {
                    setConnectionStatus('FirebaseË®≠ÂÆö„ÅåÂøÖË¶Å„Åß„Åô');
                    setIsLoading(false);
                    return;
                }

                const reservationsRef = database.ref('reservations');
                
                // „É™„Ç¢„É´„Çø„Ç§„É†„É™„Çπ„Éä„ÉºË®≠ÂÆö
                const listener = reservationsRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        const reservationsList = Object.keys(data).map(key => ({
                            ...data[key],
                            id: key
                        }));
                        setReservations(reservationsList);
                        setConnectionStatus('‚úÖ ÂêåÊúü‰∏≠');
                    } else {
                        setReservations([]);
                        setConnectionStatus('‚úÖ Êé•Á∂öÊ∏à„Åø');
                    }
                    setIsLoading(false);
                }, (error) => {
                    console.error('„Éá„Éº„ÇøÂèñÂæó„Ç®„É©„Éº:', error);
                    setConnectionStatus('‚ö†Ô∏è Êé•Á∂ö„Ç®„É©„Éº');
                    setIsLoading(false);
                });

                // Êé•Á∂öÁä∂ÊÖã„ÅÆÁõ£Ë¶ñ
                const connectedRef = database.ref('.info/connected');
                connectedRef.on('value', (snapshot) => {
                    if (snapshot.val() === true) {
                        setConnectionStatus('‚úÖ ÂêåÊúü‰∏≠');
                    } else {
                        setConnectionStatus('‚ö†Ô∏è „Ç™„Éï„É©„Ç§„É≥');
                    }
                });

                // „ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
                return () => {
                    reservationsRef.off('value', listener);
                    connectedRef.off();
                };
            }, []);

            useEffect(() => {
                if (formData.startHour !== '' && formData.startMinute !== '' && 
                    formData.endHour !== '' && formData.endMinute !== '') {
                    
                    const startTime = `${formData.startHour}:${formData.startMinute}`;
                    const endTime = `${formData.endHour}:${formData.endMinute}`;
                    
                    const start = new Date(`2000-01-01T${startTime}`);
                    const end = new Date(`2000-01-01T${endTime}`);
                    
                    if (end > start) {
                        const diffMs = end - start;
                        const diffHours = diffMs / (1000 * 60 * 60);
                        const price = calculatePrice(diffHours);
                        setCalculatedHours(diffHours);
                        setCalculatedPrice(price);
                    } else {
                        setCalculatedPrice(null);
                        setCalculatedHours(null);
                    }
                } else {
                    setCalculatedPrice(null);
                    setCalculatedHours(null);
                }
            }, [formData.startHour, formData.startMinute, formData.endHour, formData.endMinute]);

            // „Ç´„É¨„É≥„ÉÄ„Éº„ÅßÈÅ∏Êäû„Åó„ÅüÊó•‰ªò„Çí„Éï„Ç©„Éº„É†„Å´ÂèçÊò†
            useEffect(() => {
                // „É≠„Éº„Ç´„É´„Çø„Ç§„É†„Çæ„Éº„É≥„ÅßÊó•‰ªòÊñáÂ≠óÂàó„ÇíÂèñÂæóÔºàUTCÂ§âÊèõ„Å´„Çà„Çã1Êó•„Åö„Çå„ÇíÈò≤„ÅêÔºâ
                const year = selectedDate.getFullYear();
                const month = String(selectedDate.getMonth() + 1).padStart(2, '0');
                const day = String(selectedDate.getDate()).padStart(2, '0');
                const localDateString = `${year}-${month}-${day}`;
                
                setFormData(prev => ({
                    ...prev,
                    date: localDateString
                }));
            }, [selectedDate]);

            // ÁèæÂú®„ÅÆ„É¶„Éº„Ç∂„Éº„ÅåÂ§âÊõ¥„Åï„Çå„Åü„Å®„Åç„Å´„Éï„Ç©„Éº„É†„ÅÆ‰ΩøÁî®ËÄÖ„ÇÇÊõ¥Êñ∞
            useEffect(() => {
                if (currentUser) {
                    setFormData(prev => ({
                        ...prev,
                        member: currentUser
                    }));
                }
            }, [currentUser]);

            const getDaysInMonth = (date) => {
                const year = date.getFullYear();
                const month = date.getMonth();
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startingDayOfWeek = firstDay.getDay();

                const days = [];

                // Previous month days
                const prevMonthLastDay = new Date(year, month, 0).getDate();
                for (let i = startingDayOfWeek - 1; i >= 0; i--) {
                    days.push({
                        date: new Date(year, month - 1, prevMonthLastDay - i),
                        isCurrentMonth: false
                    });
                }

                // Current month days
                for (let i = 1; i <= daysInMonth; i++) {
                    days.push({
                        date: new Date(year, month, i),
                        isCurrentMonth: true
                    });
                }

                // Next month days
                const remainingDays = 42 - days.length;
                for (let i = 1; i <= remainingDays; i++) {
                    days.push({
                        date: new Date(year, month + 1, i),
                        isCurrentMonth: false
                    });
                }

                return days;
            };

            const handlePrevMonth = () => {
                setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1));
            };

            const handleNextMonth = () => {
                setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1));
            };

            // „É≠„Ç∞„Ç§„É≥Âá¶ÁêÜ
            const handleLogin = (e) => {
                e.preventDefault();
                const member = members.find(m => m.name === selectedMemberForLogin);
                if (member && member.pin === pinInput) {
                    setCurrentUser(selectedMemberForLogin);
                    setIsAuthenticated(true);
                    setIsAdmin(member.isAdmin || false);
                    setShowLoginModal(false);
                    localStorage.setItem('authenticatedUser', selectedMemberForLogin);
                    setPinInput('');
                    alert(`${selectedMemberForLogin}„Å®„Åó„Å¶„É≠„Ç∞„Ç§„É≥„Åó„Åæ„Åó„Åü`);
                } else {
                    alert('PIN„Ç≥„Éº„Éâ„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì');
                    setPinInput('');
                }
            };

            // „É≠„Ç∞„Ç¢„Ç¶„ÉàÂá¶ÁêÜ
            const handleLogout = () => {
                if (window.confirm('„É≠„Ç∞„Ç¢„Ç¶„Éà„Åó„Åæ„Åô„ÅãÔºü')) {
                    setCurrentUser(null);
                    setIsAuthenticated(false);
                    setIsAdmin(false);
                    setShowLoginModal(true);
                    setShowAdminMode(false);
                    localStorage.removeItem('authenticatedUser');
                    setPinInput('');
                }
            };

            // „É°„É≥„Éê„ÉºËøΩÂä†Âá¶ÁêÜ
            const handleAddMember = async (e) => {
                e.preventDefault();
                
                if (!newMemberName || !newMemberPin) {
                    alert('ÂêçÂâç„Å®PIN„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }

                if (newMemberPin.length !== 4 || !/^\d{4}$/.test(newMemberPin)) {
                    alert('PIN„Ç≥„Éº„Éâ„ÅØ4Ê°Å„ÅÆÊï∞Â≠ó„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }

                // ÂêçÂâç„ÅÆÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ
                if (members.some(m => m.name === newMemberName)) {
                    alert('Âêå„ÅòÂêçÂâç„ÅÆ„É°„É≥„Éê„Éº„ÅåÊó¢„Å´Â≠òÂú®„Åó„Åæ„Åô');
                    return;
                }

                try {
                    await database.ref('members').push({
                        name: newMemberName,
                        pin: newMemberPin
                    });
                    setNewMemberName('');
                    setNewMemberPin('');
                    alert('„É°„É≥„Éê„Éº„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü');
                } catch (error) {
                    console.error('„É°„É≥„Éê„ÉºËøΩÂä†„Ç®„É©„Éº:', error);
                    alert('„É°„É≥„Éê„Éº„ÅÆËøΩÂä†„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            };

            // „É°„É≥„Éê„ÉºÂâäÈô§Âá¶ÁêÜÔºàÁÆ°ÁêÜËÄÖ„ÅÆ„ÅøÔºâ
            const handleDeleteMember = async (memberId, memberName) => {
                if (!isAdmin) {
                    alert('„É°„É≥„Éê„Éº„ÅÆÂâäÈô§„ÅØÁÆ°ÁêÜËÄÖ„ÅÆ„ÅøÂÆüË°å„Åß„Åç„Åæ„Åô');
                    return;
                }

                // ÁÆ°ÁêÜËÄÖËá™Ë∫´„ÅØÂâäÈô§„Åß„Åç„Å™„ÅÑ
                const memberToDelete = members.find(m => m.id === memberId);
                if (memberToDelete && memberToDelete.isAdmin) {
                    alert('ÁÆ°ÁêÜËÄÖ„Ç¢„Ç´„Ç¶„É≥„Éà„ÅØÂâäÈô§„Åß„Åç„Åæ„Åõ„Çì');
                    return;
                }

                // „Åù„ÅÆ„É°„É≥„Éê„Éº„ÅÆ‰∫àÁ¥Ñ„Åå„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                const memberReservations = reservations.filter(r => r.member === memberName);
                
                if (memberReservations.length > 0) {
                    alert(`${memberName}„ÅÆ‰∫àÁ¥Ñ„Åå${memberReservations.length}‰ª∂„ÅÇ„Çä„Åæ„Åô„ÄÇÂÖà„Å´‰∫àÁ¥Ñ„ÇíÂâäÈô§„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`);
                    return;
                }

                if (window.confirm(`${memberName}„ÇíÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü`)) {
                    try {
                        await database.ref(`members/${memberId}`).remove();
                        alert('„É°„É≥„Éê„Éº„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü');
                    } catch (error) {
                        console.error('„É°„É≥„Éê„ÉºÂâäÈô§„Ç®„É©„Éº:', error);
                        alert('„É°„É≥„Éê„Éº„ÅÆÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                    }
                }
            };

            // ÁÆ°ÁêÜËÄÖÁî®: ÊåáÂÆöÊúà„ÅÆ„É°„É≥„Éê„ÉºÂà•Áµ±Ë®à„ÇíË®àÁÆó
            const getMemberStatsForMonth = (year, month) => {
                const stats = {};
                
                reservations.forEach(reservation => {
                    const resDate = new Date(reservation.date + 'T00:00:00');
                    if (resDate.getFullYear() === year && resDate.getMonth() === month) {
                        if (!stats[reservation.member]) {
                            stats[reservation.member] = {
                                count: 0,
                                totalHours: 0,
                                totalPrice: 0,
                                reservations: []
                            };
                        }
                        stats[reservation.member].count += 1;
                        stats[reservation.member].totalHours += reservation.hours;
                        stats[reservation.member].totalPrice += reservation.price;
                        stats[reservation.member].reservations.push(reservation);
                    }
                });
                
                return stats;
            };

            // ÁÆ°ÁêÜËÄÖÁî®: ÊåáÂÆöÊúà„ÅÆÁâπÂÆö„É°„É≥„Éê„Éº„ÅÆ‰∫àÁ¥Ñ‰∏ÄË¶ß„ÇíÂèñÂæó
            const getMemberReservationsForMonth = (memberName, year, month) => {
                return reservations
                    .filter(reservation => {
                        const resDate = new Date(reservation.date + 'T00:00:00');
                        return reservation.member === memberName && 
                               resDate.getFullYear() === year && 
                               resDate.getMonth() === month;
                    })
                    .sort((a, b) => new Date(a.date) - new Date(b.date));
            };

            // ÁÆ°ÁêÜËÄÖÁî®: ‰∫àÁ¥ÑÂâäÈô§Ôºà„Åô„Åπ„Å¶„ÅÆ‰∫àÁ¥Ñ„ÇíÂâäÈô§ÂèØËÉΩÔºâ
            const handleAdminDeleteReservation = async (id) => {
                if (!isAdmin) {
                    alert('„Åì„ÅÆÊìç‰Ωú„ÅØÁÆ°ÁêÜËÄÖ„ÅÆ„ÅøÂÆüË°å„Åß„Åç„Åæ„Åô');
                    return;
                }

                if (window.confirm('„Åì„ÅÆ‰∫àÁ¥Ñ„ÇíÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü')) {
                    try {
                        await database.ref(`reservations/${id}`).remove();
                        alert('‰∫àÁ¥Ñ„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü');
                    } catch (error) {
                        console.error('ÂâäÈô§„Ç®„É©„Éº:', error);
                        alert('ÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                    }
                }
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!formData.date || formData.startHour === '' || formData.startMinute === '' || 
                    formData.endHour === '' || formData.endMinute === '' || !calculatedPrice) {
                    alert('Êó•‰ªò„ÄÅÈñãÂßãÊôÇÂàª„ÄÅÁµÇ‰∫ÜÊôÇÂàª„ÇíÊ≠£„Åó„ÅèÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    return;
                }

                if (!isFirebaseReady) {
                    alert('FirebaseË®≠ÂÆö„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ‰∏ãÈÉ®„ÅÆË®≠ÂÆö„Ç¨„Ç§„Éâ„Çí„ÅîÁ¢∫Ë™ç„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    return;
                }

                const startTime = `${formData.startHour}:${formData.startMinute}`;
                const endTime = `${formData.endHour}:${formData.endMinute}`;

                // ÊôÇÈñì„ÅÆÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ
                const existingReservations = reservations.filter(r => r.date === formData.date);
                
                const parseTime = (timeStr) => {
                    const [hours, minutes] = timeStr.split(':').map(Number);
                    return hours * 60 + minutes;
                };

                const newStartMinutes = parseTime(startTime);
                const newEndMinutes = parseTime(endTime);

                // ÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ
                const hasConflict = existingReservations.some(reservation => {
                    const existingStartMinutes = parseTime(reservation.startTime);
                    const existingEndMinutes = parseTime(reservation.endTime);
                    
                    // ÈáçË§áÂà§ÂÆö: Êñ∞Ë¶è‰∫àÁ¥Ñ„ÅÆÈñãÂßãÊôÇÂàª„ÅåÊó¢Â≠ò‰∫àÁ¥Ñ„ÅÆÊôÇÈñìÂÜÖ„ÄÅ„Åæ„Åü„ÅØÊñ∞Ë¶è‰∫àÁ¥Ñ„ÅÆÁµÇ‰∫ÜÊôÇÂàª„ÅåÊó¢Â≠ò‰∫àÁ¥Ñ„ÅÆÊôÇÈñìÂÜÖ„ÄÅ
                    // „Åæ„Åü„ÅØÊñ∞Ë¶è‰∫àÁ¥Ñ„ÅåÊó¢Â≠ò‰∫àÁ¥Ñ„ÇíÂÆåÂÖ®„Å´Âê´„ÇÄÂ†¥Âêà
                    return (
                        (newStartMinutes < existingEndMinutes && newEndMinutes > existingStartMinutes)
                    );
                });

                if (hasConflict) {
                    alert('ÈÅ∏Êäû„Åó„ÅüÊôÇÈñìÂ∏Ø„ÅØÊó¢„Å´‰∫àÁ¥Ñ„ÅåÂÖ•„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇÂà•„ÅÆÊôÇÈñìÂ∏Ø„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    return;
                }

                const newReservation = {
                    date: formData.date,
                    member: formData.member,
                    startTime: startTime,
                    endTime: endTime,
                    hours: calculatedHours,
                    price: calculatedPrice,
                    createdAt: firebase.database.ServerValue.TIMESTAMP
                };

                try {
                    await database.ref('reservations').push(newReservation);
                    setFormData({
                        member: currentUser,
                        date: formData.date,
                        startHour: '12',
                        startMinute: '00',
                        endHour: '12',
                        endMinute: '00'
                    });
                    setCalculatedPrice(null);
                    setCalculatedHours(null);
                    alert('‰∫àÁ¥Ñ„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüÔºÅ');
                } catch (error) {
                    console.error('‰∫àÁ¥ÑËøΩÂä†„Ç®„É©„Éº:', error);
                    alert('‰∫àÁ¥Ñ„ÅÆËøΩÂä†„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇFirebaseË®≠ÂÆö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                }
            };

            const handleDelete = async (id) => {
                if (!isFirebaseReady) {
                    alert('FirebaseË®≠ÂÆö„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ');
                    return;
                }

                if (window.confirm('„Åì„ÅÆ‰∫àÁ¥Ñ„ÇíÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü')) {
                    try {
                        await database.ref(`reservations/${id}`).remove();
                    } catch (error) {
                        console.error('ÂâäÈô§„Ç®„É©„Éº:', error);
                        alert('ÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ');
                    }
                }
            };

            const getReservationsForDate = (date) => {
                // „É≠„Éº„Ç´„É´„Çø„Ç§„É†„Çæ„Éº„É≥„ÅßÊó•‰ªòÊñáÂ≠óÂàó„ÇíÂèñÂæóÔºàUTCÂ§âÊèõ„Å´„Çà„Çã1Êó•„Åö„Çå„ÇíÈò≤„ÅêÔºâ
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const dateStr = `${year}-${month}-${day}`;
                return reservations.filter(r => r.date === dateStr);
            };

            const selectedDateReservations = getReservationsForDate(selectedDate);

            const days = getDaysInMonth(currentDate);
            const weekDays = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];

            if (isLoading) {
                return (
                    <div className="container">
                        <div className="header">
                            <h1>
                                <span className="car-icon">üöó</span>
                                ÂÆ∂Êóè„Ç´„Éº„Ç∑„Çß„Ç¢ÁÆ°ÁêÜ
                            </h1>
                        </div>
                        <div style={{
                            background: 'white',
                            padding: '50px',
                            borderRadius: '20px',
                            textAlign: 'center',
                            fontSize: '1.2rem',
                            color: 'var(--text-light)'
                        }}>
                            „Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠...
                        </div>
                    </div>
                );
            }

            return (
                <>
                    {showLoginModal && (
                        <div className="modal-overlay">
                            <div className="modal-content">
                                <h2>üîê „É≠„Ç∞„Ç§„É≥</h2>
                                {members.length === 0 ? (
                                    <div style={{textAlign: 'center', padding: '20px', color: 'var(--text-light)'}}>
                                        „É°„É≥„Éê„Éº„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠...
                                    </div>
                                ) : (
                                    <form onSubmit={handleLogin} className="login-form">
                                        <div className="form-group">
                                            <label>‰ΩøÁî®ËÄÖ„ÇíÈÅ∏Êäû</label>
                                            <select
                                                value={selectedMemberForLogin}
                                                onChange={(e) => setSelectedMemberForLogin(e.target.value)}
                                                style={{
                                                    width: '100%',
                                                    padding: '12px',
                                                    fontSize: '1rem',
                                                    borderRadius: '10px',
                                                    border: '2px solid var(--border)',
                                                    fontFamily: 'Outfit, sans-serif'
                                                }}
                                            >
                                                {members.map(member => (
                                                    <option key={member.id} value={member.name}>{member.name}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div className="form-group">
                                            <label>4Ê°Å„ÅÆPIN„Ç≥„Éº„Éâ</label>
                                            <input
                                                type="password"
                                                className="pin-input"
                                                value={pinInput}
                                                onChange={(e) => setPinInput(e.target.value)}
                                                maxLength="4"
                                                pattern="[0-9]{4}"
                                                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                                required
                                                autoFocus
                                            />
                                        </div>
                                        <button type="submit" className="btn-primary" style={{marginTop: '10px'}}>
                                            „É≠„Ç∞„Ç§„É≥
                                        </button>
                                    </form>
                                )}
                            </div>
                        </div>
                    )}

                    {showMemberManagement && (
                        <div className="modal-overlay">
                            <div className="modal-content" style={{maxWidth: '500px'}}>
                                <h2>üë• „É°„É≥„Éê„ÉºÁÆ°ÁêÜ</h2>
                                
                                <div className="member-list">
                                    {members.map(member => (
                                        <div key={member.id} className="member-item">
                                            <span className="member-name">{member.name}</span>
                                            <button 
                                                className="delete-member-btn"
                                                onClick={() => handleDeleteMember(member.id, member.name)}
                                            >
                                                ÂâäÈô§
                                            </button>
                                        </div>
                                    ))}
                                </div>

                                <form onSubmit={handleAddMember} className="login-form">
                                    <h3 style={{marginBottom: '15px', color: 'var(--primary)'}}>Êñ∞Ë¶è„É°„É≥„Éê„ÉºËøΩÂä†</h3>
                                    <div className="form-group">
                                        <label>ÂêçÂâç</label>
                                        <input
                                            type="text"
                                            value={newMemberName}
                                            onChange={(e) => setNewMemberName(e.target.value)}
                                            placeholder="‰æã: Ê¨°Â•≥"
                                            style={{
                                                width: '100%',
                                                padding: '12px',
                                                fontSize: '1rem',
                                                borderRadius: '10px',
                                                border: '2px solid var(--border)',
                                                fontFamily: 'Outfit, sans-serif'
                                            }}
                                            required
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>4Ê°Å„ÅÆPIN„Ç≥„Éº„Éâ</label>
                                        <input
                                            type="password"
                                            className="pin-input"
                                            value={newMemberPin}
                                            onChange={(e) => setNewMemberPin(e.target.value)}
                                            maxLength="4"
                                            pattern="[0-9]{4}"
                                            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                            required
                                        />
                                    </div>
                                    <div style={{display: 'flex', gap: '10px', marginTop: '10px'}}>
                                        <button type="submit" className="btn-primary" style={{flex: 1}}>
                                            „É°„É≥„Éê„Éº„ÇíËøΩÂä†
                                        </button>
                                        <button 
                                            type="button" 
                                            className="logout-btn" 
                                            style={{flex: 1}}
                                            onClick={() => {
                                                setShowMemberManagement(false);
                                                setNewMemberName('');
                                                setNewMemberPin('');
                                            }}
                                        >
                                            Èñâ„Åò„Çã
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}

                    {showAdminMode && isAdmin && (
                        <div className="modal-overlay">
                            <div className="modal-content" style={{maxWidth: '900px', maxHeight: '80vh', overflow: 'auto'}}>
                                <h2>üëë ÁÆ°ÁêÜËÄÖ„É¢„Éº„Éâ</h2>
                                
                                <div className="month-selector">
                                    <button onClick={() => setSelectedMonth(new Date(selectedMonth.getFullYear(), selectedMonth.getMonth() - 1, 1))}>
                                        ‚Üê ÂâçÊúà
                                    </button>
                                    <span style={{fontSize: '1.2rem', fontWeight: '600', minWidth: '150px', textAlign: 'center'}}>
                                        {selectedMonth.getFullYear()}Âπ¥ {selectedMonth.getMonth() + 1}Êúà
                                    </span>
                                    <button onClick={() => setSelectedMonth(new Date(selectedMonth.getFullYear(), selectedMonth.getMonth() + 1, 1))}>
                                        Ê¨°Êúà ‚Üí
                                    </button>
                                </div>

                                {(() => {
                                    const stats = getMemberStatsForMonth(selectedMonth.getFullYear(), selectedMonth.getMonth());
                                    const memberNames = Object.keys(stats).sort();

                                    return (
                                        <>
                                            <h3 style={{marginTop: '20px', marginBottom: '15px', color: 'var(--primary)'}}>
                                                üìä „É°„É≥„Éê„ÉºÂà•Áµ±Ë®à
                                            </h3>
                                            {memberNames.length === 0 ? (
                                                <p style={{textAlign: 'center', color: 'var(--text-light)', padding: '20px'}}>
                                                    „Åì„ÅÆÊúà„ÅÆ‰∫àÁ¥Ñ„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì
                                                </p>
                                            ) : (
                                                <table className="stats-table">
                                                    <thead>
                                                        <tr>
                                                            <th>„É°„É≥„Éê„Éº</th>
                                                            <th>‰∫àÁ¥ÑÂõûÊï∞</th>
                                                            <th>ÂêàË®àÊôÇÈñì</th>
                                                            <th>ÂêàË®àÈáëÈ°ç</th>
                                                            <th>Êìç‰Ωú</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {memberNames.map(memberName => (
                                                            <tr key={memberName}>
                                                                <td style={{fontWeight: '600'}}>{memberName}</td>
                                                                <td>{stats[memberName].count}Âõû</td>
                                                                <td>{stats[memberName].totalHours.toFixed(2)}ÊôÇÈñì</td>
                                                                <td>¬•{stats[memberName].totalPrice.toLocaleString()}</td>
                                                                <td>
                                                                    <button
                                                                        className="nav-btn"
                                                                        style={{padding: '6px 12px', fontSize: '0.85rem'}}
                                                                        onClick={() => setSelectedMemberForStats(memberName)}
                                                                    >
                                                                        Ë©≥Á¥∞
                                                                    </button>
                                                                </td>
                                                            </tr>
                                                        ))}
                                                    </tbody>
                                                </table>
                                            )}

                                            {selectedMemberForStats && (
                                                <>
                                                    <h3 style={{marginTop: '30px', marginBottom: '15px', color: 'var(--primary)'}}>
                                                        üìù {selectedMemberForStats}„ÅÆÂà©Áî®Â±•Ê≠¥
                                                    </h3>
                                                    <div className="reservation-list" style={{maxHeight: '300px', marginBottom: '20px'}}>
                                                        {getMemberReservationsForMonth(
                                                            selectedMemberForStats,
                                                            selectedMonth.getFullYear(),
                                                            selectedMonth.getMonth()
                                                        ).map(reservation => (
                                                            <div key={reservation.id} className="reservation-item">
                                                                <h4>{reservation.date}</h4>
                                                                <div className="reservation-detail">
                                                                    {reservation.startTime} - {reservation.endTime}
                                                                </div>
                                                                <div className="reservation-detail">
                                                                    ‰ΩøÁî®ÊôÇÈñì: {reservation.hours.toFixed(2)}ÊôÇÈñì
                                                                </div>
                                                                <div className="reservation-price">
                                                                    ¬•{reservation.price.toLocaleString()}
                                                                </div>
                                                                <button
                                                                    className="delete-btn"
                                                                    onClick={() => handleAdminDeleteReservation(reservation.id)}
                                                                >
                                                                    ÂâäÈô§
                                                                </button>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </>
                                            )}
                                        </>
                                    );
                                })()}

                                <button 
                                    className="btn-primary" 
                                    style={{width: '100%', marginTop: '20px'}}
                                    onClick={() => {
                                        setShowAdminMode(false);
                                        setSelectedMemberForStats('');
                                    }}
                                >
                                    Èñâ„Åò„Çã
                                </button>
                            </div>
                        </div>
                    )}
                    
                    <div className="container">
                    <div className="header">
                        <h1>
                            <span className="car-icon">üöó</span>
                            ÂÆ∂Êóè„Ç´„Éº„Ç∑„Çß„Ç¢ÁÆ°ÁêÜ
                        </h1>
                        <div style={{display: 'flex', flexDirection: 'column', alignItems: 'flex-end', gap: '10px'}}>
                            <div style={{display: 'flex', alignItems: 'center', gap: '10px'}}>
                                <span style={{fontSize: '0.95rem', color: 'var(--text)', fontWeight: '600'}}>
                                    „É≠„Ç∞„Ç§„É≥‰∏≠: <span style={{color: 'var(--primary)', fontSize: '1.1rem'}}>{currentUser}</span>
                                </span>
                                {isAdmin && (
                                    <button className="admin-mode-btn" onClick={() => setShowAdminMode(true)}>
                                        üëë ÁÆ°ÁêÜËÄÖ„É¢„Éº„Éâ
                                    </button>
                                )}
                                <button className="manage-members-btn" onClick={() => setShowMemberManagement(true)}>
                                    „É°„É≥„Éê„ÉºÁÆ°ÁêÜ
                                </button>
                                <button className="logout-btn" onClick={handleLogout}>
                                    „É≠„Ç∞„Ç¢„Ç¶„Éà
                                </button>
                            </div>
                            <div className="date-display">
                                {new Date().toLocaleDateString('ja-JP', {
                                    year: 'numeric',
                                    month: 'long',
                                    day: 'numeric',
                                    weekday: 'long'
                                })}
                            </div>
                            <div style={{fontSize: '0.85rem', color: connectionStatus.includes('‚úÖ') ? '#27ae60' : '#e74c3c', display: 'flex', alignItems: 'center', gap: '5px'}}>
                                {connectionStatus}
                            </div>
                        </div>
                    </div>

                    <div className="main-content">
                        <div className="calendar-section">
                            <div className="calendar-header">
                                <h2>
                                    {currentDate.getFullYear()}Âπ¥ {currentDate.getMonth() + 1}Êúà
                                </h2>
                                <div className="nav-buttons">
                                    <button className="nav-btn" onClick={handlePrevMonth}>
                                        ‚Üê ÂâçÊúà
                                    </button>
                                    <button className="nav-btn" onClick={handleNextMonth}>
                                        Ê¨°Êúà ‚Üí
                                    </button>
                                </div>
                            </div>

                            <div className="calendar">
                                {weekDays.map((day, index) => (
                                    <div 
                                        key={day} 
                                        className={`day-header ${index === 0 ? 'sunday' : ''} ${index === 6 ? 'saturday' : ''}`}
                                    >
                                        {day}
                                    </div>
                                ))}
                                {days.map((day, index) => {
                                    const dayReservations = getReservationsForDate(day.date);
                                    const isSelected = selectedDate.toDateString() === day.date.toDateString();
                                    const isToday = new Date().toDateString() === day.date.toDateString();
                                    const dayOfWeek = day.date.getDay();
                                    const isSunday = dayOfWeek === 0;
                                    const isSaturday = dayOfWeek === 6;
                                    
                                    return (
                                        <div
                                            key={index}
                                            className={`day-cell 
                                                ${!day.isCurrentMonth ? 'other-month' : ''} 
                                                ${isSelected ? 'selected' : ''} 
                                                ${isToday ? 'today' : ''}
                                                ${isSunday ? 'sunday' : ''}
                                                ${isSaturday ? 'saturday' : ''}`}
                                            onClick={() => setSelectedDate(day.date)}
                                        >
                                            <div className="day-number">{day.date.getDate()}</div>
                                            <div className="day-reservations">
                                                {dayReservations.slice(0, 3).map((res, i) => (
                                                    <div key={i} className="reservation-indicator" />
                                                ))}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>

                        <div className="sidebar">
                            <div className="card">
                                <h3>
                                    {selectedDate.toDateString() === new Date().toDateString() 
                                        ? 'üìÖ Êú¨Êó•„ÅÆ‰∫àÁ¥ÑÁä∂Ê≥Å' 
                                        : `üìÖ ${selectedDate.getMonth() + 1}/${selectedDate.getDate()}„ÅÆ‰∫àÁ¥ÑÁä∂Ê≥Å`}
                                </h3>
                                <div className="reservation-list" style={{maxHeight: '300px'}}>
                                    {selectedDateReservations.length === 0 ? (
                                        <p style={{color: 'var(--text-light)', textAlign: 'center', padding: '20px'}}>
                                            ‰∫àÁ¥Ñ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì
                                        </p>
                                    ) : (
                                        selectedDateReservations.map(reservation => (
                                            <div key={reservation.id} className="reservation-item">
                                                <h4>{reservation.member}</h4>
                                                <div className="reservation-detail">
                                                    {reservation.startTime} - {reservation.endTime}
                                                </div>
                                                <div className="reservation-detail">
                                                    ‰ΩøÁî®ÊôÇÈñì: {reservation.hours.toFixed(2)}ÊôÇÈñì
                                                </div>
                                                <div className="reservation-price">
                                                    ¬•{reservation.price.toLocaleString()}
                                                </div>
                                                {(reservation.member === currentUser || isAdmin) && (
                                                    <button
                                                        className="delete-btn"
                                                        onClick={() => isAdmin ? handleAdminDeleteReservation(reservation.id) : handleDelete(reservation.id)}
                                                    >
                                                        ÂâäÈô§
                                                    </button>
                                                )}
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>

                            <div className="card">
                                <h3>‚ûï Êñ∞Ë¶è‰∫àÁ¥Ñ</h3>
                                <form onSubmit={handleSubmit}>
                                    <div className="form-group">
                                        <label>‰ΩøÁî®Êó•</label>
                                        <div style={{display: 'flex', alignItems: 'center', gap: '10px'}}>
                                            <input
                                                type="date"
                                                value={formData.date}
                                                onChange={(e) => setFormData({...formData, date: e.target.value})}
                                                required
                                                style={{flex: 1}}
                                            />
                                            {formData.date && (
                                                <span style={{
                                                    color: 'var(--text-light)', 
                                                    fontSize: '1rem',
                                                    fontWeight: '500',
                                                    minWidth: '40px'
                                                }}>
                                                    ({new Date(formData.date + 'T00:00:00').toLocaleDateString('ja-JP', { weekday: 'short' })})
                                                </span>
                                            )}
                                        </div>
                                    </div>
                                    <div className="form-group">
                                        <label>‰ΩøÁî®ËÄÖ</label>
                                        <select
                                            value={formData.member}
                                            onChange={(e) => setFormData({...formData, member: e.target.value})}
                                        >
                                            {members.map(member => (
                                                <option key={member.id} value={member.name}>{member.name}</option>
                                            ))}
                                        </select>
                                    </div>
                                    <div className="form-group">
                                        <label>ÈñãÂßãÊôÇÂàª</label>
                                        <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '10px'}}>
                                            <select
                                                value={formData.startHour}
                                                onChange={(e) => setFormData({...formData, startHour: e.target.value})}
                                                required
                                            >
                                                {Array.from({length: 24}, (_, i) => (
                                                    <option key={i} value={String(i).padStart(2, '0')}>
                                                        {String(i).padStart(2, '0')}ÊôÇ
                                                    </option>
                                                ))}
                                            </select>
                                            <select
                                                value={formData.startMinute}
                                                onChange={(e) => setFormData({...formData, startMinute: e.target.value})}
                                                required
                                            >
                                                <option value="00">00ÂàÜ</option>
                                                <option value="15">15ÂàÜ</option>
                                                <option value="30">30ÂàÜ</option>
                                                <option value="45">45ÂàÜ</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div className="form-group">
                                        <label>ÁµÇ‰∫ÜÊôÇÂàª</label>
                                        <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '10px'}}>
                                            <select
                                                value={formData.endHour}
                                                onChange={(e) => setFormData({...formData, endHour: e.target.value})}
                                                required
                                            >
                                                {Array.from({length: 24}, (_, i) => (
                                                    <option key={i} value={String(i).padStart(2, '0')}>
                                                        {String(i).padStart(2, '0')}ÊôÇ
                                                    </option>
                                                ))}
                                            </select>
                                            <select
                                                value={formData.endMinute}
                                                onChange={(e) => setFormData({...formData, endMinute: e.target.value})}
                                                required
                                            >
                                                <option value="00">00ÂàÜ</option>
                                                <option value="15">15ÂàÜ</option>
                                                <option value="30">30ÂàÜ</option>
                                                <option value="45">45ÂàÜ</option>
                                            </select>
                                        </div>
                                    </div>

                                    {calculatedPrice !== null && (
                                        <div className="calculation-display">
                                            <p><strong>‰ΩøÁî®ÊôÇÈñì:</strong> {calculatedHours.toFixed(2)}ÊôÇÈñì</p>
                                            <p><strong>ÊñôÈáë:</strong> ¬•{calculatedPrice.toLocaleString()}</p>
                                        </div>
                                    )}

                                    <button type="submit" className="btn-primary">
                                        ‰∫àÁ¥Ñ„ÇíËøΩÂä†
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                </>
            );
        };

        ReactDOM.render(<CarSharingApp />, document.getElementById('root'));
    </script>
</body>
</html>
